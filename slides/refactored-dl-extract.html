<h1>Refactored: Download and Extract</h1>

<pre class="codehilite">
<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">cache_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">tar_file</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
  <span class="n">source</span>      <span class="n">tar_url</span>
  <span class="n">checksum</span>    <span class="n">tar_checksum</span>
  <span class="n">mode</span>        <span class="s2">&quot;0644&quot;</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s2">&quot;extract nginx tarball&quot;</span> <span class="k">do</span>
  <span class="n">cwd</span>       <span class="n">cache_dir</span>
  <span class="n">command</span>   <span class="sx">%{tar zxf </span><span class="si">#{</span><span class="n">tar_file</span><span class="si">}</span><span class="sx">}</span>
  <span class="n">creates</span>   <span class="s2">&quot;</span><span class="si">#{</span><span class="n">cache_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">tar_dir</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre>
